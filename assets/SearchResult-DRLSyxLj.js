import{u as U,g as ee,h as se,i as _,j as te,k as le,t as ae,l as ie,m as D,n as R,p as re,w as ne,q as t,v as ue,R as j,x as oe,y as ce,z as ve,D as ye,A as he,B as me,C as de,E as ge,F as pe,G as b,H as fe,I as Ee,J as ke,K as He,L as T,M as G,N as we}from"./app-ByOJvoRd.js";const Re=["/","/intro.html","/articles/GitLab-Install-Docker.html","/articles/GitLab-Install.html","/articles/","/articles/Waline-Install.html","/articles/friends.html","/articles/helloworld.html","/en/","/en/intro.html","/en/articles/GitLab-Install-Docker.html","/en/articles/GitLab-Install.html","/en/articles/","/en/articles/Waline-Install.html","/en/articles/friends.html","/en/articles/helloworld.html","/posts/essay/1.html","/posts/essay/","/en/posts/essay/1.html","/en/posts/essay/","/404.html","/posts/","/en/posts/","/category/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/%E6%95%99%E7%A8%8B/","/category/%E7%BD%91%E7%BB%9C/","/category/%E7%A0%B4%E8%A7%A3/","/category/%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5/","/category/%E7%BA%AA%E5%BF%B5/","/category/%E9%9A%8F%E6%89%8B%E8%B4%B4/","/en/category/","/en/category/guide/","/en/category/tutorial/","/en/category/network/","/en/category/crack/","/en/category/friendly-link/","/en/category/commemoration/","/en/category/essay/","/tag/","/tag/gitlab/","/tag/linux/","/tag/git/","/tag/ruby/","/tag/docker/","/tag/debian/","/tag/golang/","/tag/node.js/","/tag/friends/","/tag/hello/","/en/tag/","/en/tag/gitlab/","/en/tag/linux/","/en/tag/git/","/en/tag/ruby/","/en/tag/docker/","/en/tag/debian/","/en/tag/golang/","/en/tag/node.js/","/en/tag/friends/","/en/tag/hello/","/article/","/en/article/","/star/","/en/star/","/timeline/","/en/timeline/"],be="SLIMSEARCH_QUERY_HISTORY",g=U(be,[]),xe=()=>{const{queryHistoryCount:l}=b,a=l>0;return{enabled:a,queryHistories:g,addQueryHistory:i=>{a&&(g.value=Array.from(new Set([i,...g.value.slice(0,l-1)])))},removeQueryHistory:i=>{g.value=[...g.value.slice(0,i),...g.value.slice(i+1)]}}},I=l=>Re[l.id]+("anchor"in l?`#${l.anchor}`:""),Ae="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:M}=b,p=U(Ae,[]),Be=()=>{const l=M>0;return{enabled:l,resultHistories:p,addResultHistory:a=>{if(l){const i={link:I(a),display:a.display};"header"in a&&(i.header=a.header),p.value=[i,...p.value.slice(0,M-1)]}},removeResultHistory:a=>{p.value=[...p.value.slice(0,a),...p.value.slice(a+1)]}}},Ce=l=>{const a=ye(),i=_(),x=he(),n=D(0),E=R(()=>n.value>0),m=me([]);return de(()=>{const{search:d,terminate:A}=ge(),f=pe(o=>{const{resultsFilter:k=u=>u,querySplitter:S,suggestionsFilter:B,...C}=a.value;o?(n.value+=1,d(o,i.value,C).then(u=>k(u,o,i.value,x.value)).then(u=>{n.value-=1,m.value=u}).catch(u=>{console.warn(u),n.value-=1,n.value||(m.value=[])})):m.value=[]},b.searchDelay-b.suggestDelay,{maxWait:5e3});fe([l,i],([o])=>f(o.join(" "))),Ee(()=>{A()})}),{isSearching:E,results:m}};var Le=ee({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:a}){const i=se(),x=_(),n=te(le),{enabled:E,addQueryHistory:m,queryHistories:d,removeQueryHistory:A}=xe(),{enabled:f,resultHistories:o,addResultHistory:k,removeResultHistory:S}=Be(),B=E||f,C=ae(l,"queries"),{results:u,isSearching:O}=Ce(C),r=ie({isQuery:!0,index:0}),y=D(0),h=D(0),F=R(()=>B&&(d.value.length>0||o.value.length>0)),q=R(()=>u.value.length>0),L=R(()=>u.value[y.value]||null),P=()=>{const{isQuery:e,index:s}=r;s===0?(r.isQuery=!e,r.index=e?o.value.length-1:d.value.length-1):r.index=s-1},W=()=>{const{isQuery:e,index:s}=r;s===(e?d.value.length-1:o.value.length-1)?(r.isQuery=!e,r.index=0):r.index=s+1},Y=()=>{y.value=y.value>0?y.value-1:u.value.length-1,h.value=L.value.contents.length-1},z=()=>{y.value=y.value<u.value.length-1?y.value+1:0,h.value=0},J=()=>{h.value<L.value.contents.length-1?h.value+=1:z()},K=()=>{h.value>0?h.value-=1:Y()},Q=e=>e.map(s=>we(s)?s:t(s[0],s[1])),N=e=>{if(e.type==="customField"){const s=ke[e.index]||"$content",[c,w=""]=He(s)?s[x.value].split("$content"):s.split("$content");return e.display.map(v=>t("div",Q([c,...v,w])))}return e.display.map(s=>t("div",Q(s)))},H=()=>{y.value=0,h.value=0,a("updateQuery",""),a("close")},V=()=>E?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},n.value.queryHistory),d.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:r.isQuery&&r.index===s}],onClick:()=>{a("updateQuery",e)}},[t(T,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:G,onClick:c=>{c.preventDefault(),c.stopPropagation(),A(s)}})]))])):null,X=()=>f?t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},n.value.resultHistory),o.value.map((e,s)=>t(j,{to:e.link,class:["slimsearch-result-item",{active:!r.isQuery&&r.index===s}],onClick:()=>{H()}},()=>[t(T,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(c=>Q(c)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:G,onClick:c=>{c.preventDefault(),c.stopPropagation(),S(s)}})]))])):null;return re("keydown",e=>{if(l.isFocusing){if(q.value){if(e.key==="ArrowUp")K();else if(e.key==="ArrowDown")J();else if(e.key==="Enter"){const s=L.value.contents[h.value];m(l.queries.join(" ")),k(s),i.push(I(s)),H()}}else if(f){if(e.key==="ArrowUp")P();else if(e.key==="ArrowDown")W();else if(e.key==="Enter"){const{index:s}=r;r.isQuery?(a("updateQuery",d.value[s]),e.preventDefault()):(i.push(o.value[s].link),H())}}}}),ne([y,h],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:l.queries.length?!q.value:!F.value}],id:"slimsearch-results"},l.queries.length?O.value?t(ue,{hint:n.value.searching}):q.value?t("ul",{class:"slimsearch-result-list"},u.value.map(({title:e,contents:s},c)=>{const w=y.value===c;return t("li",{class:["slimsearch-result-list-item",{active:w}]},[t("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((v,Z)=>{const $=w&&h.value===Z;return t(j,{to:I(v),class:["slimsearch-result-item",{active:$,"aria-selected":$}],onClick:()=>{m(l.queries.join(" ")),k(v),H()}},()=>[v.type==="text"?null:t(v.type==="title"?oe:v.type==="heading"?ce:ve,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[v.type==="text"&&v.header?t("div",{class:"content-header"},v.header):null,t("div",N(v))])])})])})):n.value.emptyResult:B?F.value?[V(),X()]:n.value.emptyHistory:n.value.emptyResult)}});export{Le as default};
